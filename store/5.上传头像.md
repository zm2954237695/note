### 上传头像

##### 1上传头像-持久层

   ##### 1.1SQL语句的规划

   将对象文件保存在操作系统上，然后再把这个文件路径记录在数据库中。

   对应的是一个更新用户avatar字段的sql语句.

```mysql
   update t_user set avatar = ?,modified_user = ?,modified_time = ? where uid = ? 
```

   ##### 1.2 设计接口和抽象方法

1.3编写xml文件

2.  上传头像-业务层

   2.1 规划异常

    1.用户数据不存在，找不到对应的用户的数据异常

     2.更新时，产生未知异常.

   (无需重复开发)

 2.2设计接口和抽象方法

```java
/**
 * 修改用户的头像
 * @param uid 用户id
 * @param avatar 用户头像的路径
 * @param username  用户的名称
 */
void changeAvatar(Integer uid,String avatar
                  ,String username);
```

2.3实现抽象方法

### 3 上传头像-控制层

#### 3.1 规划异常

 ```wiki
 文件异常的父类:
 FileUploadException 泛指文件上传的异常(父类)继承RuntimeException
 父类是： FileUploadException
 FileEmptyException
 FileSizeException
 FileStateException
 FileTypeException
 FileUploadIOException
 ```

#### 3.2 设计请求

```http
/users/change_avatar
POST(Get请求提交数据2kb)
HttpSession session , MutipartFile file
JsonResult<String>

```



### 4 上传头像前端页面

在upload页面中编写上传头像的代码

```w
说明：如果直接使用表单进行文件的上传，需要给表单显示添加一个属性 enctype="multipart/form-data"声明出来,不会将目标文件的数据结构做修改在上传，不同字符串.
```

### 5 解决BUG

#### 5.1 更改默认的大小限制

SpringMVC默认为1MB文件进行上传，手动的去修改SpringMVC默认上传文件的大小。

方式1：直接在配置文件中进行配置：

```properties
spring.servlet.multipart.maxFileSize=10MB
spring.servlet.multipart.maxRequestSize=15MB
```

方式2:采用Java代码的形式来设置上传文件的大小限制.在主类中进行配置，可以定义一个方法，必须使用@Bean来修饰。在类的前面添加@Configration来修饰类.

```java
@Bean
    public MultipartConfigElement getMultipartConfigElement(){
        MultipartConfigFactory factory = new MultipartConfigFactory();
        return factory.createMultipartConfig();
    }
```

#### 5.2 显示头像

在页面中通过ajax请求来提交文件，提交完成后返回json串，解析出data数据设置到img头像标签的src属性即可。

- serialize():可以将表单数据自动拼接成key=value的结构进行提交给服务器，一般提交是普通的控件类型中的数据(text\password\radio\checkbox)等等
- FormDate类：将表单的数据保持原有的结构进行数据的提交。new FormData($("#form")[0]);

#### 5.3 登录后显示头像

