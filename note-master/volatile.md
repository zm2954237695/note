#### volatile的作用和原理

##### 作用

- 保证可见性。

​       一旦一个共享变量被volatile修饰后，就具备了两层语义：

   保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量的值，修改的    新值对其他线程是立即可见的。

- 禁止指令的重排列。

- volatile不能确保原子性.

##### 原理

通过查看加入volatile关键字和没有加入volatile关键字生成的汇编代码发现，使用了volatile关键字，会多出一个lock前缀指令。

lock前缀指令相当于一个内存屏障，主要有以下三个功能:

- 确保指令重排序时不会把其后面的指令排到内存屏障的前面，也不会把其前面的指令排到内存屏障的后面；即在执行到内存屏障这句指令时，在它前面的其它操作也全部完成。
- 强制将对缓存的修改操作立即写入主存。
- 如果是写操作，会导致其他cpu中对应的缓存行失效。



##### 什么是原子性

一个事务中包含了多个操作，这些操作要么全部执行，要么都不执行。实现事务的原子性，要支持回滚操作，在某个操作失败后，能回到事务执行之前的状态。